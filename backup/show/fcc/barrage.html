<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
<style>
html,body{
  height: 100%;
  widht: 100%;
  background-color: #999;
}
h2{
  line-height: 3em;
  text-shadow: 2px 1px 2px #000;
  color: #FFF;
  font-weight: bold;
}
.window,.control{
  margin-left: auto;
  margin-right: auto;
}
.window{
  width: 80%;
  height: 50%;
  position: relative;
  overflow: hidden;
  min-height: 300px;
  border-radius: 5px;
  background-color: #EEE;
}
.control{
  width: 60%;
  margin-top: 1%;
}
button{
  margin-top: 1%;
  background-color: #FFF;
  cursor: pointer;
}
button:active{
  background-color: #000;
  color: #FFF;
}
.msg{
  display: inline-block;
  position: absolute;
}
</style>
  </head>
<body>
<title>FCC-3-弹幕墙</title>
<h2 class="text-center">wilddog弹幕墙</h2>
<div class="window">
</div>
<div class="control text-center">
  <div class="input-group">
    <input type="text" class="form-control" placeholder="请输入发射弹幕文字~(*・ω・)✄╰ひ╯">
  </div>
  <div class="container">
    <div class="row">
      <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
        <button type="button" class="btn btn-default btn-md" id="btn-send">
          <i class="fa fa-paper-plane-o" aria-hidden="true"></i>发射弹幕
        </button>
      </div>
      <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
        <button type="button" class="btn btn-default btn-md" id="btn-clean">
          <i class="fa fa-trash" aria-hidden="true"></i>清除弹幕
        </button>
      </div>
      <div class="col-lg-6"></div>
    </div>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://cdn.wilddog.com/sdk/js/2.5.1/wilddog.js"></script>
<script>
$(document).ready(function(){
  var win = $(".window");
  var barrageMsg = [];
  var pos;
  /*创建Sync实例*/
  var config = {
    syncURL: "https://lysnakescreen.wilddogio.com" //输入节点 URL
  };
  wilddog.initializeApp(config);
  var ref = wilddog.sync().ref();

  /*发送数据到wilddogio*/
  $("#btn-send").click(function(){
    var msg = $("input").val();
    if(msg == ""){
      return false;
    }
    ref.child('message').push(msg);
    console.log("send msg:  " + msg);
    $("input").val("");
  });
  /*清除本地弹幕*/
  $("#btn-clean").click(function(){
    ref.remove();
    win.empty();
    barrageMsg = [];
    console.log("clean ~~~");
  });
    $("input").keypress( function(e){
   if(e.which == 13){
        $("#btn-send").trigger('click');
      }
  });
  /*监听数据*/
  ref.on('child_removed', function(snapshot) {
    barrageMsg = [];
  });
  ref.child("message").on("child_added",function(snapshot){
    var msg = snapshot.val();
    var style = "style="+'"color: rgb('+randomColor()+","+randomColor()+","+randomColor()+');' +
        "top:" + randomPosition()+ 'em;'+
        "right:" + '-'+msg.length+'em"';
    barrageMsg.push(Number(msg.length)*(-1));
    win.append("<span class='msg' " +style+'"'+">" + msg+ "</span>");
    win.children().last().animate({
      "right": win.width(),
    },
    2500 + Math.floor(Math.random()*3000),
    "linear",
    function(){
       this.remove();
      });
  });

  function randomColor(){
    return Math.floor(Math.random()*255);
  }
  function randomPosition(){
    var p ;
    while(true){

     p = Math.floor(Math.random()*5);
      if(p == pos){
        //避免先后二个弹幕在同一行
        continue;
      }else{
        pos = p;
        return p;
      }
    }
  }
})
</script>
  </body>
</html>
